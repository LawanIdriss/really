<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google One Tap Authentication</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
  <style>
    /* Add any specific styles to ensure layout isn't broken */
    body {
      position: relative;
      min-height: 100vh;
    }

    /* Ensuring that Google One Tap prompt is correctly positioned */
    #g_id_onload, .g_id_signin {
      position: absolute;
      top: 0; /* Adjust based on your layout */
      left: 0; /* Adjust based on your layout */
      z-index: 9999; /* Ensure it's above other elements */
    }
  </style>
  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBdBJZnp8WC11YV6yc5HP-FAMFHD6lwerU",
      authDomain: "fixespoint-app.firebaseapp.com",
      projectId: "fixespoint-app",
      storageBucket: "fixespoint-app.appspot.com",
      messagingSenderId: "462898145069",
      appId: "1:462898145069:web:b1998a949a60d39b9cd5a4",
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    window.onload = function() {
      // Initialize Google One Tap
      google.accounts.id.initialize({
        client_id: '462898145069-o5gme6h0o8aq4rr7e7ee3j34c50rpnsr.apps.googleusercontent.com',
        callback: handleCredentialResponse,
        cancel_on_tap_outside: false,  // Keep the prompt open if the user clicks outside
      });

      // Show the One Tap UI
      google.accounts.id.prompt((notification) => {
        // Check if the user dismisses the prompt
        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
          console.log('One Tap prompt not displayed or skipped');
        } else {
          // Set a timeout to hide the prompt after 10 seconds
          setTimeout(() => {
            google.accounts.id.cancel();
          }, 10000); // 10 seconds
        }
      });
    };

    function handleCredentialResponse(response) {
      // Get the ID token from the response
      const idToken = response.credential;

      // Authenticate with Firebase
      firebase.auth().signInWithCredential(firebase.auth.GoogleAuthProvider.credential(idToken))
        .then((result) => {
          // User signed in successfully
          const user = result.user;

          // Store user data in local storage
          localStorage.setItem('user', JSON.stringify({
            uid: user.uid,
            displayName: user.displayName,
            email: user.email,
            photoURL: user.photoURL
          }));

          // Redirect to the app
          window.location.href = 'https://fixespoint.com/app';
        })
        .catch((error) => {
          // Handle errors here
          console.error('Error signing in: ', error);
        });
    }
  </script>
</head>
<body>
  <!-- Your existing content -->
  <button id="loginButton">Login</button>
</body>
</html>
